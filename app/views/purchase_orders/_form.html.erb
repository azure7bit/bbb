<fieldset>
  <div class="row-fluid sortable">
    <div class="box span6">
      <div class="box-content">
        <div class="control-group">
          <%= f.label :po_number, "PO. Number", :class => "control-label" %>
          <div class="controls po">
            <%= f.text_field :po_number, :class=>"input-xlarge", :placeholder => "po number here ..", :autofocus => true, :readonly => true, :value => @po_number %>
          </div>
        </div>
        <div class="control-group">
          <%= f.label :po_date, "PO. Date", :class => "control-label" %>
          <div class="controls po">
            <%= f.text_field :po_date, :class=>"input-xlarge", :placeholder => "date here ..", :readonly => true, :value => @po_date %>
          </div>
        </div>
        <div class="control-group">
          <%= f.label :spph_number, "SPPH Number", :class => "control-label" %>
          <div class="controls spph">
            <%= f.text_field :spph_number, :class=>"input-xlarge", :placeholder => "spph number here .." %>
          </div>
        </div>
        <div class="control-group">
          <%= f.label :spph_date, "SPPH Date", :class => "control-label" %>
          <div class="controls spph">
            <%= f.text_field :spph_date, :class=>"input-xlarge", :placeholder => "spph date here .." %>
          </div>
        </div>
      </div>
    </div>
    <div class="box span6">
      <div class="box-content">
        <div class="control-group">
          <%= f.label :supplier_id, "Supplier Name", :class => "control-label" %>
          <div class="controls supplier">
            <%= f.select :supplier_id, options_from_collection_for_select(@suppliers, "id","full_id", @purchase_order.nil? ? "" : :selected => @purchase_order.supplier_id),{:prompt => 'Choose Supplier'}, :'data-rel'=>"chosen" %>
          </div>
        </div>
        <div class="control-group">
          <%= f.label :supplier_address, "Address", :class => "control-label" %>
          <div class="controls">
            <%= f.text_area :supplier_address, :rows => 2, :disabled => 'disabled', :class=>"input-xlarge", :placeholder => "supplier address here .." %>
          </div>
        </div>
        <div class="control-group">
          <%= f.label :supplier_city, "City", :class => "control-label" %>
          <div class="controls">
            <%= f.text_field :supplier_city, :disabled => 'disabled', :class=>"input-xlarge", :placeholder => "supplier city here .." %>
          </div>
        </div>
        <%= link_to "Browse Item", "#", :class => "btn btn-primary supplier-items" %>
      </div>
    </div>
  </div>
  <%= render "supplier_items" %>
</fieldset>
<fieldset>
<div class="box-content">
  <table class="table table-striped table-bordered bootstrap-datatable po-items">
    <thead>
      <tr>
        <th>Item Code</th>
        <th>Item Name</th>
        <th width="5%">Qty</th>
        <th>Price</th>
        <th>Subtotal</th>
        <th>Notes</th>
      </tr>
    </thead>   
    <tbody>
    </tbody>
  </table>            
</div>
</fieldset>
<fieldset>
  <div class="form-actions">
    <%= f.submit 'Save changes', :class => "btn btn-primary" %>
    <button id="cancel-edit" class="btn">Cancel</button>
  </div>
</fieldset>

<%= javascript_include_tag 'jquery-1.7.2.min' %>
<script type="text/javascript">
  $(document).ready(function () {

    $('#purchase_order_po_date').datepicker({ dateFormat: "yy-mm-dd" });
    $('#purchase_order_spph_date').datepicker({ dateFormat: "yy-mm-dd" });

  });

  $("#purchase_order_supplier_id").change(function() {
    var supplier_address_text = $("purchase_order_supplier_address");
    var supplier_city_text = $("purchase_order_supplier_city");
    if($(this).val()) {
      $.ajax({
        url: '/purchase_orders/supplier_info',
        type: 'GET',
        async: false,
        dataType: 'json',
        data: {
          purchase_order: {
            'supplier_id' : $(this).val()
          }
        },
        success: function(data) {
          $("textarea#purchase_order_supplier_address").val(data.address);
          $("input#purchase_order_supplier_city").val(data.city);
        },
        error: function(data){},
      });
    } else {
      $("textarea#purchase_order_supplier_address").val("");
      $("input#purchase_order_supplier_city").val("");
    }
  });

  $('.supplier-items').click(function(e){
    e.preventDefault();

    if($("#purchase_order_supplier_id").val()) {
      if ($(".control-group").hasClass('has-error')) $(".control-group").removeClass('has-error');
      $("div.control-group p").remove();
      $.ajax({
        url: '/purchase_orders/supplier_items',
        type: 'GET',
        async: false,
        dataType: 'script',
        data: {
          purchase_order: {
            'supplier_id' : $("#purchase_order_supplier_id").val()
          }
        },
        success: function(data) {},
        error: function(data){},
      });
    } else {
      if ($(".control-group").hasClass('has-error')) $(".control-group").removeClass('has-error');
      $("div.control-group p").remove();
      var error_msg = "Please select Supplier"
      $(".control-group div.supplier").append('<p><i id="error-msg">' + error_msg + '</i></p>');
      $(".control-group div.supplier").parent().addClass('has-error');
      return false;
    }
  });

  $(".item-submit").click(function(){
    var items = new Array();
    $.each($("input[name='item_ids[]']:checked"), function() {
      items.push($(this).val());
      $.ajax({
        url: '/purchase_orders/item_detail',
        type: 'GET',
        async: false,
        dataType: 'script',
        data: {
          purchase_order: {
            'supplier_id' : $("#purchase_order_supplier_id").val(),
            'item_id' : $(this).val()
          }
        },
        success: function(data) {},
        error: function(data){},
      });    
    });
    $('#supplier-items').modal('hide');
  });

</script>