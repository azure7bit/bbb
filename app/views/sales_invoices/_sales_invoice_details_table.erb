<div class="box span12">
  <div class="box-content">
    <h2>List Items</h2>
    <table id="items-table" class="table table-striped table-bordered">
      <thead>
        <tr>
          <th>Nama Barang</th>
          <th>Harga</th>
          <th>Harga(Rp)</th>
          <th>qty</th>
          <th>Subtotal</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        <%= f.fields_for :sales_invoice_details do |detail| %>
          <tr class="fields">
            <%= f.fields_for :items do |item| %>
              <td><%= detail.hidden_field :item_id, readonly: true %></td>
              <td>
                <%= text_field_tag :valas_price, nil, readonly: true, :onkeypress=>"return numbersonly(event)", :onkeyup => "totalTransaction(this)" %>
              </td>
              <td><%= item.text_field :retail_price, readonly: true %></td>
            <% end %>
            <td><%= detail.text_field :qty, readonly: true %></td>
            <td>
              <%= link_to_remove_fields('<i class="icon-remove"></i>'.html_safe, detail) %>
              <%= item.text_field :name, readonly: true %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>

<script type="text/javascript">
  $("#to_idr").click(function() {
    selectedCurrency();
  });

  function selectedCurrency() {
    $(".fields").each(function(index, value) {
      var valas_price = $($(this).find('input')[1]).val();
      var idr_price = $($(this).find('input')[2]).val();
      var qty = $($(this).find('input')[3]).val();
      if ($("#to_idr").prop('checked')) {
        $($(this).find('input')[4]).val(qty * idr_price)
      } else {
        $($(this).find('input')[4]).val(qty * valas_price)
      }
    });
    calculateTotal();
  }
</script>